{{- /* 1. Ưu tiên lấy từ biến môi trường, nếu không có mới dùng promptStringOnce làm dự phòng */ -}}
{{- $email := env "EMAIL_ADDRESS" | default (promptStringOnce . "email" "Email address" "vovanphu1012@gmail.com") -}}
{{- $name := env "USER_NAME" | default (promptStringOnce . "name" "User name" "vovanphu") -}}

{{- /* OS and Environment Detection */ -}}
{{- $is_wsl := false -}}
{{- if (env "WSL_DISTRO_NAME") -}}
{{-   $is_wsl = true -}}
{{- end -}}

{{- /* Machine Role Selection */ -}}
{{- $role_default := "chimera" -}}
{{- if not (or (eq .chezmoi.os "windows") $is_wsl) -}}
{{-   $role_default = "cyclops" -}}
{{- end -}}
{{- /* Lấy ROLE từ env hoặc fallback */ -}}
{{- $role := env "ROLE" | default (promptStringOnce . "role" "Machine Role" $role_default) -}}

{{- /* Hostname Selection */ -}}
{{- $hostname_selection := env "HOSTNAME" | default (promptStringOnce . "hostname" "Enter Hostname" "custom") -}}

{{- /* If custom, ask for custom hostname (fallback for interactive use) */ -}}
{{- if eq $hostname_selection "custom" -}}
{{-   $hostname_selection = promptString "Enter Custom Hostname" -}}
{{- end -}}
sourceDir: {{ .chezmoi.sourceDir | quote }}
{{- if eq .chezmoi.os "windows" }}
pager: ""
{{- end }}

bitwarden:
    command: "bw"

data:
    email: {{ $email | quote }}
    name: {{ $name | quote }}
    osid: {{ .chezmoi.os | quote }}
    is_wsl: {{ $is_wsl }}
    role: {{ $role | quote }}
    hostname: {{ $hostname_selection | quote }}
    
    # Aliases
    commonAliases:
        g: "git"
        st: "git status"
        chez: "chezmoi"
    
    # OS-Specific Overrides
    winAliases:
        l: "Get-ChildItem -Force"
    
    unixAliases:
        l: "ls -lah"
    
    editor: "nvim"
